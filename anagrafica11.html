<!DOCTYPE html>
<html>
<head>
  <title>AnagraficaJSON - Avanzata</title>
  <style>
    body { font-family: Arial; background:#f4f7fb; text-align:center; margin:0; padding:0; }
    h2 { background:#2b6cb0; color:white; padding:15px; margin:0; border-bottom:4px solid #1a4f8b; }
    .container { margin:20px; }
    button, input[type="text"], select {
      background:#2b6cb0; color:white; padding:10px 20px; border:none; border-radius:8px;
      cursor:pointer; margin:5px; font-size:15px; transition:.3s;
    }
    button:hover { background:#1a4f8b; }
    table { width:80%; margin:20px auto; border-collapse:collapse; background:white; }
    th,td { padding:10px; border:1px solid #ccc; }
    th { background:#2b6cb0; color:white; }
    tr:nth-child(even){ background:#f2f2f2; }
    #messaggio { color:red; font-weight:bold; }
  </style>
</head>
<body>

<h2>Tabella Anagrafica (XMLHttpRequest)</h2>

<div id="messaggio"></div>

<div class="container">
  <button id="creaTabella">Carica e crea Tabella</button>
</div>

<table id="tabella"></table>

<div class="container">
  <h3>Ricerca persone per cognome</h3>
  <input type="text" id="letteraInserita" maxlength="1" placeholder="Scrivi la prima lettera">
  <button id="bottoneCerca">Cerca</button>
</div>

<div class="container">
  <h3>Scopri la generazione</h3>
  <select id="dataSelezionata">
    <option value="">Seleziona una data di nascita</option>
  </select>
  <button id="bottoneGenerazione">Calcola generazione</button>
  <p id="risultatoGenerazione" style="font-weight:bold;"></p>
</div>

<script>

let datiPersone = [];

//----------------------------
// 1) CARICAMENTO CON XMLHttpRequest
//----------------------------
function caricaJSON() {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "persone.json", true);

    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {

                datiPersone = JSON.parse(xhr.responseText);
                document.getElementById("messaggio").innerHTML = "File JSON caricato correttamente.";

                // Riempi il select delle date
                let selezione = document.getElementById("dataSelezionata");
                selezione.innerHTML = '<option value="">Seleziona una data di nascita</option>';

                datiPersone.forEach(p => {
                    let opt = document.createElement("option");
                    opt.value = p.data;
                    opt.textContent = p.data + " - " + p.cognome + " " + p.nome;
                    selezione.appendChild(opt);
                });

                creaTabella();

            } else {
                document.getElementById("messaggio").innerHTML = "Errore: impossibile caricare il file JSON.";
            }
        }
    };

    xhr.send();
}

//----------------------------
// 2) CREA TABELLA
//----------------------------
function creaTabella() {
    const tabella = document.getElementById("tabella");

    let html = "<tr><th>Nome</th><th>Cognome</th><th>Data</th><th>Indirizzo</th><th>Città</th><th>CAP</th></tr>";

    datiPersone.forEach(p => {
        html += `
            <tr>
                <td>${p.nome}</td>
                <td>${p.cognome}</td>
                <td>${p.data}</td>
                <td>${p.indirizzo}</td>
                <td>${p.citta}</td>
                <td>${p.cap}</td>
            </tr>
        `;
    });

    tabella.innerHTML = html;
}

//----------------------------
// 3) RICERCA PER COGNOME
//----------------------------
document.getElementById("bottoneCerca").onclick = function() {
    let lettera = document.getElementById("letteraInserita").value.toUpperCase();

    if (lettera === "") {
        document.getElementById("messaggio").innerHTML = "Inserisci una lettera.";
        return;
    }

    let risultati = datiPersone.filter(p => p.cognome.toUpperCase().startsWith(lettera));

    const tabella = document.getElementById("tabella");

    if (risultati.length === 0) {
        tabella.innerHTML = "";
        document.getElementById("messaggio").innerHTML = "Nessun cognome trovato.";
        return;
    }

    let html = "<tr><th>Nome</th><th>Cognome</th><th>Data</th><th>Indirizzo</th><th>Città</th><th>CAP</th></tr>";

    risultati.forEach(p => {
        html += `
        <tr>
            <td>${p.nome}</td>
            <td>${p.cognome}</td>
            <td>${p.data}</td>
            <td>${p.indirizzo}</td>
            <td>${p.citta}</td>
            <td>${p.cap}</td>
        </tr>`;
    });

    tabella.innerHTML = html;
};

//----------------------------
// 4) CALCOLO GENERAZIONE
//----------------------------
document.getElementById("bottoneGenerazione").onclick = function() {
    let data = document.getElementById("dataSelezionata").value;

    if (data === "") {
        document.getElementById("risultatoGenerazione").innerHTML = "Seleziona una data.";
        return;
    }

    let anno = new Date(data).getFullYear();
    let gen = "";

    if (anno >= 1901 && anno <= 1927) gen = "Greatest Generation";
    else if (anno >= 1928 && anno <= 1945) gen = "Generazione Silenziosa";
    else if (anno >= 1946 && anno <= 1964) gen = "Baby Boomers";
    else if (anno >= 1965 && anno <= 1980) gen = "Generazione X";
    else if (anno >= 1981 && anno <= 1996) gen = "Millennials";
    else if (anno >= 1997 && anno <= 2012) gen = "Generazione Z";
    else if (anno >= 2013) gen = "Generazione Alpha";
    else gen = "Troppo vecchia";

    document.getElementById("risultatoGenerazione").innerHTML =
        "Appartiene alla " + gen;
};

//----------------------------
// AVVIO: carica JSON quando clicchi il bottone
//----------------------------
document.getElementById("creaTabella").onclick = caricaJSON;

</script>

</body>
</html>
