<!DOCTYPE html>
<html>
<head>
  <title>Anagrafica11 - JSON da File</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fb;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    h2 {
      background-color: #2b6cb0;
      color: white;
      padding: 15px;
      margin: 0;
      border-bottom: 4px solid #1a4f8b;
    }

    .container {
      margin: 20px;
    }

    button, label, select, input[type="text"] {
      background-color: #2b6cb0;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      font-size: 15px;
      transition: background-color 0.3s;
      display: inline-block;
    }

    button:hover, label:hover {
      background-color: #1a4f8b;
    }

    input[type="file"] {
      display: none;
    }

    table {
      border-collapse: collapse;
      width: 85%;
      margin: 20px auto;
      background-color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #2b6cb0;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    #messaggio {
      color: red;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <h2>Anagrafica da File JSON</h2>
  <div id="messaggio"></div>

  <div class="container">
    <label for="fileJson">Carica File JSON</label>
    <input type="file" id="fileJson" accept=".json">
    <button id="creaTabella">Crea Tabella</button>
  </div>

  <table id="tabella"></table>

  <div class="container">
    <h3>Ricerca per cognome</h3>
    <input type="text" id="letteraInserita" maxlength="1" placeholder="Inserisci lettera">
    <button id="bottoneCerca">Cerca</button>
  </div>

  <div class="container">
    <h3>Calcola generazione</h3>
    <select id="dataSelezionata">
      <option value="">Seleziona una data</option>
    </select>
    <button id="bottoneGenerazione">Calcola</button>
    <p id="risultatoGenerazione"></p>
  </div>

<script>

let datiPersone = [];

// -----------------------------
// LETTURA FILE JSON DA PC
// -----------------------------
document.getElementById("fileJson").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = function(e) {
        try {
            datiPersone = JSON.parse(e.target.result);
            document.getElementById("messaggio").innerHTML = "File JSON caricato correttamente!";

            // Aggiorna select generazioni
            let select = document.getElementById("dataSelezionata");
            select.innerHTML = '<option value="">Seleziona una data</option>';

            datiPersone.forEach(p => {
                let opt = document.createElement("option");
                opt.value = p.data;
                opt.textContent = p.data + " - " + p.cognome + " " + p.nome;
                select.appendChild(opt);
            });

        } catch {
            document.getElementById("messaggio").innerHTML = "Errore: formato JSON non valido!";
        }
    };

    reader.readAsText(file);
});


// -----------------------------
// CREA TABELLA
// -----------------------------
document.getElementById("creaTabella").onclick = function () {
    if (datiPersone.length === 0) {
        document.getElementById("messaggio").innerHTML = "Carica prima un file JSON!";
        return;
    }

    let tab = `
    <tr>
        <th>Nome</th><th>Cognome</th><th>Data</th>
        <th>Indirizzo</th><th>Città</th><th>CAP</th>
    </tr>`;

    datiPersone.forEach(p => {
        tab += `
        <tr>
          <td>${p.nome}</td>
          <td>${p.cognome}</td>
          <td>${p.data}</td>
          <td>${p.indirizzo}</td>
          <td>${p.citta}</td>
          <td>${p.cap}</td>
        </tr>`;
    });

    document.getElementById("tabella").innerHTML = tab;
};



// -----------------------------
// RICERCA PER COGNOME
// -----------------------------
document.getElementById("bottoneCerca").onclick = function () {
    let lettera = document.getElementById("letteraInserita").value.toUpperCase();
    if (!lettera) return alert("Inserisci una lettera!");

    let risultati = datiPersone.filter(p => p.cognome.toUpperCase().startsWith(lettera));

    if (risultati.length === 0) {
        document.getElementById("tabella").innerHTML = "";
        document.getElementById("messaggio").innerHTML =
            "Nessun cognome trovato con la lettera " + lettera;
        return;
    }

    let tab = `
    <tr>
        <th>Nome</th><th>Cognome</th><th>Data</th>
        <th>Indirizzo</th><th>Città</th><th>CAP</th>
    </tr>`;

    risultati.forEach(p => {
        tab += `
        <tr>
          <td>${p.nome}</td>
          <td>${p.cognome}</td>
          <td>${p.data}</td>
          <td>${p.indirizzo}</td>
          <td>${p.citta}</td>
          <td>${p.cap}</td>
        </tr>`;
    });

    document.getElementById("tabella").innerHTML = tab;
};



// -----------------------------
// CALCOLO GENERAZIONE
// -----------------------------
document.getElementById("bottoneGenerazione").onclick = function () {

    let data = document.getElementById("dataSelezionata").value;

    if (!data) {
        document.getElementById("risultatoGenerazione").innerHTML =
            "Seleziona una data valida!";
        return;
    }

    let anno = new Date(data).getFullYear();
    let gen = "";

    if (anno >= 1901 && anno <= 1927) gen = "Greatest Generation";
    else if (anno >= 1928 && anno <= 1945) gen = "Silent Generation";
    else if (anno >= 1946 && anno <= 1964) gen = "Baby Boomers";
    else if (anno >= 1965 && anno <= 1980) gen = "Generazione X";
    else if (anno >= 1981 && anno <= 1996) gen = "Millennials";
    else if (anno >= 1997 && anno <= 2012) gen = "Generazione Z";
    else if (anno >= 2013) gen = "Generazione Alpha";
    else gen = "Errore nella data";

    document.getElementById("risultatoGenerazione").innerHTML =
        "Questa persona appartiene alla: <b>" + gen + "</b>";
};

</script>

</body>
</html>
